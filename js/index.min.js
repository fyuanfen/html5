$(function(){var g=document;var a=g.getElementById("canvas");var i=a.getContext("2d");var h=$("#gameBox");var f=h.find("li");var d=new Image();var b=[1,2,3,4,5,6,7,8,9];var e=[1,2,3,4,5,6,7,8,9];var c={timeHandle:null,isComplete:false,level:0,levels:[{time:"60.00",image:"img/shulan.png"},{time:"40.00",image:"img/tuzi.png"},{time:"30.00",image:"img/together.png"},{time:"20.00",image:"img/shengdan.png"}],bind:function(){$("body").on("touchstart",function(j){j.preventDefault()});f.draggable="true";f.on("dragstart",function(j){j.dataTransfer.setData("Index",$(this).index())});f.on("dragover",function(j){j.preventDefault()});f.on("drop",function(m){m.preventDefault();var j=m.dataTransfer.getData("Index");var l=f.eq(j);var k=$(this).html();$(this).html(l.html());$(l).html(k);c.check()});f.on("swipeLeft",function(n){n.preventDefault();var m=$(this);var k=m.index();var l=m.html();var j=m.prev();if($.inArray(k,[3,6])>-1||j.size()<=0){return false}m.html(j.html());j.html(l);c.check()});f.on("swipeRight",function(n){n.preventDefault();var m=$(this);var k=m.index();var l=m.html();var j=m.next();if($.inArray(k,[2,5])>-1||j.size()<=0){return false}m.html(j.html());j.html(l);c.check()});f.on("swipeUp",function(m){m.preventDefault();var l=$(this);var k=l.html();var j=l.index()-3;var n=f.eq(j);if(j>=0&&n.size()>0){l.html(n.html());n.html(k);c.check()}});f.on("swipeDown",function(n){n.preventDefault();var m=$(this);var k=m.html();var j=m.index()+3;var l=f.eq(j);if(j<9&&l.size()>0){m.html(l.html());l.html(k);c.check()}});$("#start").on("tap click",function(){$("#reset").prop("disabled",false);if($(this).html()!=="再来一次"){c.randomImage(true)}else{c.randomImage()}c.resetData();c.countdown();$("#layer").hide()});$("#reset").on("tap click",function(){c.resetData();c.countdown();c.randomImage(true)})},countdown:function(){clearInterval(this.timeHandle);this.timeHandle=setInterval(function(){var k=$("#timing");var l=parseFloat(k.text());var j=(l-0.01).toFixed(2);if(j<0){clearInterval(c.timeHandle);k.text(parseInt(j).toFixed(2));c.update()}else{k.text(j)}},10)},resetData:function(){var j=this.levels[this.level].time;$("#timing").text(j);$("#time").text(j);$("#level").text(this.level+1);$("#levels").text(this.levels.length)},init:function(){$("#reset").prop("disabled",true);this.resetData();e=[1,2,3,4,5,6,7,8,9];this.render()},render:function(){d.onload=function(){c.randomImage()};d.src=this.levels[this.level].image},randomImage:function(k){k=k||false;if(k){e.sort(function(o,j){return Math.random()-Math.random()})}var m=1;for(var n=0;n<3;n++){for(var l=0;l<3;l++){i.drawImage(d,300*l,300*n,300,300,0,0,300,300);f.eq(e[m-1]-1).find("img").data("seq",m).attr("src",a.toDataURL("image/jpeg"));m++}}},check:function(){var j=[];$("#gameBox img").each(function(m,l){j.push(l.getAttribute("data-seq"))});if(j.join("")===b.join("")){setTimeout(function(){window.clearInterval(c.timeHandle);if(c.level>=c.levels.length-1){alert("哇塞,你居然通关了,好棒!");c.destory()}else{if(confirm("恭喜过关,是否继续挑战?")){c.level++;$("#layer").show();c.init()}}},300)}},update:function(){if(this.isComplete===false){alert("时间到,游戏结束!");$("#layer").show();$("#start").html("再来一次");$("#reset").prop("disabled",true)}},destory:function(){$("#reset").prop("disabled",true);f.off("swipeLeft");f.off("swipeRight");f.off("swipeUp");f.off("swipeDown");f.css("border",0);h.css("border",0)},start:function(){this.init();this.render();this.bind()},};c.start()});